<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no, minimal-ui">
		<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.2/pixi.min.js"></script>
		<script src="../lib/Pixim.min.js"></script>
		<script src="../dist/Pixim-animate-container.js"></script>
	</head>
	<body>
		<script>
			const describe = (name, func) => {
				try {
					func();
					console.log('success.');
				} catch (e) {
					console.error(`Failed test '${name} - ${e}'`);
				}
			};
			
			const it = (tag, func) => {
				try {
					func();
				} catch (e) {
					throw tag;
				}
			};
			
			const assert = {
				equal(a, b) {
					if (a !== b) {
						throw new Error();
					}
				},
				ok(a) {
					if (!a) {
						throw new Error();
					}
				}
			};
		</script>
		<script>
			describe('manifest', () => {
				it('class', () => {
					const app = new Pixim.Application({
						width: 450,
						height: 800,
						antialias: true,
						backgroundColor: 0xFFFFFF
					});
					
					const Game = Pixim.Content.create();
					
					Game.setConfig({
						width: 450,
						height: 800
					});
					
					Pixim.animate.defineAnimatesTo(Game, {
						test: {
							basepath: 'game/',
							filepath: 'game.js',
							id: '2FA8E0C7230941478CE2CA3DB82DBEDF_1',
							options: {
								crossOrigin: true
							}
						}
					})
					
					Game.defineLibraries({
						root: class Root extends PIXI.Container {
							constructor($) {
								super();
								
								this.x = 10;
								this.y = 10;
								this.scale.set(0.7);
								
								const container = this.addChild(new Pixim.animate.Container());
								
								container.addChild(new PIXI.Text('Library game'));
								const a = container.addCreatejs(new $.resources.animates.test.game());
								a.y = 50;
							}
						}
					});
					
					const game = new Game();
					
					return app.attachAsync(game).catch(e => {
						console.log(e)
					});
				});
				
				it('instance', () => {
					const app = new Pixim.Application({
						width: 450,
						height: 800,
						antialias: true,
						backgroundColor: 0xFFFFFF
					});
					
					const Game = Pixim.Content.create();
					
					Game.setConfig({
						width: 450,
						height: 800
					});
					
					Game.defineLibraries({
						root: class Root extends PIXI.Container {
							constructor($) {
								super();
								
								this.x = 10;
								this.y = 10;
								this.scale.set(0.7);
								
								const container = this.addChild(new Pixim.animate.Container());
								
								container.addChild(new PIXI.Text('Library game'));
								const a = container.addCreatejs(new $.resources.animates.test.game());
								a.y = 50;
							}
						}
					});
					
					const game = new Game({
						basepath: "https://localhost/Pixim-animate-container/test/",
						xhr: {
							requestOptions: {
								headers: {
									"X-A": "Bearer: hoge"
								}
							}
						},
						typeOptions: {
							animates: {
								fileVersion: 222,
								assetVersion: 345
							}
						}
					});
					
					Pixim.animate.addAnimatesTo(game, {
						test: {
							basepath: 'game/',
							filepath: 'game.js',
							id: '2FA8E0C7230941478CE2CA3DB82DBEDF_1',
							options: {
								crossOrigin: true
							}
						}
					})
					
					return app.attachAsync(game).then(() => {
						app.play()
					})
				});
			});
		</script>
	</div>
	</body>
</html>